<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Relatório Power BI - Transportes</title>
<style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100%;
    overflow: hidden;
}

.header {
    background: linear-gradient(to right, #1e5631, #2e7d32, #8bc34a);
    color: white;
    padding: 8px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    z-index: 10;
    height: 60px;
}

.logo-container {
    display: flex;
    align-items: center;
}

.logo {
    height: 40px;
    margin-right: 12px;
}

.title {
    font-size: 18px;
    font-weight: 600;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-name {
    font-weight: 500;
    max-width: 100px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.button {
    background-color: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.4);
    padding: 8px 12px;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.2s ease;
    font-size: 14px;
}

.button:hover {
    background-color: rgba(255, 255, 255, 0.3);
}

.button.secondary {
    background-color: transparent;
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.4);
}

.button.secondary:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.button.active {
    background-color: rgba(255, 255, 255, 0.4);
    color: #1e5631;
    font-weight: 600;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.button svg {
    width: 14px;
    height: 14px;
}

.view-toggle {
    display: flex;
    gap: 4px;
    margin-right: 12px;
    position: relative;
}

.view-toggle::after {
    content: 'Auto-detectado';
    position: absolute;
    bottom: -18px;
    left: 0;
    right: 0;
    text-align: center;
    font-size: 10px;
    color: rgba(255, 255, 255, 0.8);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.view-toggle.auto-detected::after {
    opacity: 1;
}

.content {
    flex: 1;
    height: calc(100vh - 60px);
    position: relative;
}

.background-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image%202-uayIptAhjXe1icvZgZU1YStcYR9KZz.png');
    background-size: cover;
    background-position: center;
    z-index: 1;
}

.report-container {
    width: 100%;
    height: 100%;
    overflow: hidden;
    position: relative;
    z-index: 2;
    transition: all 0.3s ease;
}

.report-container.mobile-view {
    width: 414px; /* Largura padrão para visualização mobile */
    height: 100%;
    margin: 0 auto;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    border-right: 1px solid rgba(0, 0, 0, 0.1);
}

.report-container iframe {
    width: 100%;
    height: 100%;
    border: none;
    position: absolute;
    top: 0;
    left: 0;
    background-color: transparent;
}

/* Estilos para o overlay de carregamento */
.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 5;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #1e5631;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.login-container, .code-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(30, 86, 49, 0.9), rgba(46, 125, 50, 0.8), rgba(212, 175, 55, 0.7));
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    padding: 16px;
}

.login-box, .code-box {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    padding: 24px 20px;
    width: 100%;
    max-width: 400px;
}

.login-title, .code-title {
    color: #1e5631;
    margin-bottom: 20px;
    font-size: 22px;
    text-align: center;
}

.form-group {
    margin-bottom: 16px;
}

label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #333;
    font-size: 15px;
}

input {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    -webkit-appearance: none;
}

input:focus {
    outline: none;
    border-color: #8bc34a;
    box-shadow: 0 0 0 2px rgba(139, 195, 74, 0.2);
}

.error-message {
    color: #e53935;
    font-size: 14px;
    margin-top: 5px;
    display: none;
}

.error-message.visible {
    display: block;
}

.button-container {
    display: flex;
    justify-content: center;
    margin-top: 24px;
}

.login-button, .code-button {
    background: linear-gradient(to right, #1e5631, #2e7d32);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
    width: 100%;
    -webkit-appearance: none;
}

.login-button:hover, .code-button:hover {
    background: linear-gradient(to right, #184a29, #256e29);
    transform: translateY(-1px);
}

.register-button {
    background: linear-gradient(to right, #d4af37, #8bc34a);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s;
    width: 100%;
    -webkit-appearance: none;
    margin-top: 10px;
}

.register-button:hover {
    background: linear-gradient(to right, #c19b2e, #7cb342);
    transform: translateY(-1px);
}

.auth-links {
    display: flex;
    justify-content: space-between;
    margin-top: 16px;
    font-size: 14px;
}

.auth-link {
    color: #1e5631;
    text-decoration: none;
    cursor: pointer;
}

.auth-link:hover {
    text-decoration: underline;
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
    display: none;
    padding: 16px;
}

.modal.visible {
    display: flex;
}

.modal-content {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    padding: 24px 20px;
    width: 100%;
    max-width: 400px;
}

.modal-title {
    color: #1e5631;
    margin-bottom: 20px;
    font-size: 20px;
}

.modal-buttons {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 24px;
}

.modal-button {
    padding: 12px 16px;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    flex: 1;
    font-size: 15px;
    transition: all 0.2s;
}

.modal-button.primary {
    background: linear-gradient(to right, #1e5631, #2e7d32);
    color: white;
}

.modal-button.primary:hover {
    background: linear-gradient(to right, #184a29, #256e29);
}

.modal-button.secondary {
    background-color: #f5f5f5;
    color: #333;
}

.modal-button.secondary:hover {
    background-color: #e5e5e5;
}

.hidden {
    display: none;
}

.tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid #ddd;
}

.tab {
    padding: 10px 20px;
    cursor: pointer;
    font-weight: 500;
    color: #666;
    position: relative;
}

.tab.active {
    color: #1e5631;
}

.tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(to right, #1e5631, #8bc34a);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.view-selection {
    display: flex;
    gap: 16px;
    margin-top: 20px;
}

.view-option {
    flex: 1;
    background-color: #f5f5f5;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.view-option:hover {
    border-color: #8bc34a;
    background-color: #f9f9f9;
    transform: translateY(-2px);
}

.view-option.selected {
    border-color: #1e5631;
    background-color: rgba(139, 195, 74, 0.1);
}

.view-option-icon {
    font-size: 32px;
    margin-bottom: 12px;
    color: #1e5631;
}

.view-option-title {
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
}

.view-option-desc {
    font-size: 13px;
    color: #666;
}

/* Estilos específicos para mobile */
@media (max-width: 480px) {
    .header {
        padding: 10px 12px;
    }
    
    .title {
        font-size: 16px;
    }
    
    .user-info {
        gap: 6px;
    }
    
    .button {
        padding: 6px 10px;
        font-size: 13px;
    }
    
    .user-name {
        max-width: 80px;
    }
    
    .login-box, .modal-content, .code-box {
        padding: 20px 16px;
    }
    
    .login-title, .code-title {
        font-size: 20px;
        margin-bottom: 16px;
    }
    
    input {
        padding: 10px;
        font-size: 16px;
    }
    
    .login-button, .modal-button, .register-button, .code-button {
        padding: 12px 16px;
    }
    
    .tabs {
        flex-direction: column;
        border-bottom: none;
    }
    
    .tab {
        padding: 8px 0;
        border-bottom: 1px solid #ddd;
    }
    
    .tab.active::after {
        display: none;
    }
    
    .tab.active {
        border-bottom: 2px solid #1e5631;
    }
    
    .view-toggle {
        margin-right: 6px;
    }
    
    .report-container.mobile-view {
        width: 100%; /* Em dispositivos móveis, a visualização mobile ocupa 100% da largura */
    }
    
    .view-selection {
        flex-direction: column;
    }
}
</style>
</head>
<body>
<div class="container">
<div class="header">
    <div class="logo-container">
        <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/Logo%20Bendito%202-sC9uiPIGvXXdDaQjjMw19LZ9D4aMOQ.png" alt="Logo Transportes" class="logo">
        <div class="title">Relatório Power BI - Transportes</div>
    </div>
    <div class="user-info hidden" id="userInfo">
        <div class="view-toggle" id="viewToggle">
            <button id="desktopViewButton" class="button">Desktop</button>
            <button id="mobileViewButton" class="button">Celular</button>
        </div>
        <span class="user-name" id="userName">Usuário</span>
        <button id="changePasswordButton" class="button secondary">Alterar</button>
        <button id="logoutButton" class="button">Sair</button>
    </div>
</div>

<div class="content">
    <!-- Imagem de fundo que ficará atrás do relatório -->
    <div class="background-image"></div>
    
    <div class="report-container" id="reportContainer">
        <!-- Overlay de carregamento -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>
        <iframe id="reportFrame" src="about:blank" allowFullScreen="true"></iframe>
    </div>
    
    <!-- Tela de código de acesso -->
    <div class="code-container" id="codeContainer">
        <div class="code-box">
            <h2 class="code-title">Selecione o Modo de Visualização</h2>
            
            <div class="view-selection">
                <div class="view-option" id="desktopOption">
                    <div class="view-option-icon">💻</div>
                    <div class="view-option-title">Desktop</div>
                    <div class="view-option-desc">Visualização completa para monitores</div>
                </div>
                
                <div class="view-option" id="mobileOption">
                    <div class="view-option-icon">📱</div>
                    <div class="view-option-title">Celular</div>
                    <div class="view-option-desc">Otimizado para dispositivos móveis</div>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="accessCode">Código de Acesso</label>
                <input type="password" id="accessCode" placeholder="Digite o código de acesso">
                <div class="error-message" id="codeError">Código inválido. Tente novamente.</div>
            </div>
            
            <div class="button-container">
                <button id="accessButton" class="code-button">Acessar Relatório</button>
            </div>
        </div>
    </div>
    
    <!-- Tela de login -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="tabs">
                <div class="tab active" id="loginTab">Login</div>
                <div class="tab" id="registerTab">Cadastro</div>
            </div>
            
            <div class="tab-content active" id="loginContent">
                <h2 class="login-title">Acesso ao Relatório</h2>
                
                <div class="form-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" placeholder="Digite seu usuário" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" autocomplete="current-password">
                    <div class="error-message" id="loginError">Usuário ou senha incorretos. Tente novamente.</div>
                </div>
                
                <div class="button-container">
                    <button id="loginButton" class="login-button">Entrar</button>
                </div>
            </div>
            
            <div class="tab-content" id="registerContent">
                <h2 class="login-title">Cadastre-se</h2>
                
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="Digite seu email" autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label for="registerUsername">Usuário</label>
                    <input type="text" id="registerUsername" placeholder="Escolha um nome de usuário" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Senha</label>
                    <input type="password" id="registerPassword" placeholder="Crie uma senha" autocomplete="new-password">
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirmar Senha</label>
                    <input type="password" id="confirmPassword" placeholder="Confirme sua senha" autocomplete="new-password">
                    <div class="error-message" id="registerError"></div>
                </div>
                
                <div class="button-container">
                    <button id="registerButton" class="register-button">Cadastrar</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Modal de Alteração de Senha -->
<div class="modal" id="changePasswordModal">
<div class="modal-content">
    <h3 class="modal-title">Alterar Senha</h3>
    
    <div class="form-group">
        <label for="currentPassword">Senha Atual</label>
        <input type="password" id="currentPassword" placeholder="Digite sua senha atual" autocomplete="current-password">
    </div>
    
    <div class="form-group">
        <label for="newPassword">Nova Senha</label>
        <input type="password" id="newPassword" placeholder="Digite a nova senha" autocomplete="new-password">
    </div>
    
    <div class="form-group">
        <label for="confirmNewPassword">Confirmar Nova Senha</label>
        <input type="password" id="confirmNewPassword" placeholder="Confirme a nova senha" autocomplete="new-password">
        <div class="error-message" id="passwordError"></div>
    </div>
    
    <div class="modal-buttons">
        <button id="cancelChangePassword" class="modal-button secondary">Cancelar</button>
        <button id="saveNewPassword" class="modal-button primary">Salvar</button>
    </div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elementos do DOM
    const loginContainer = document.getElementById('loginContainer');
    const codeContainer = document.getElementById('codeContainer');
    const reportFrame = document.getElementById('reportFrame');
    const reportContainer = document.getElementById('reportContainer');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const userInfo = document.getElementById('userInfo');
    const userName = document.getElementById('userName');
    const loginButton = document.getElementById('loginButton');
    const logoutButton = document.getElementById('logoutButton');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('loginError');
    const changePasswordButton = document.getElementById('changePasswordButton');
    const changePasswordModal = document.getElementById('changePasswordModal');
    const currentPasswordInput = document.getElementById('currentPassword');
    const newPasswordInput = document.getElementById('newPassword');
    const confirmNewPasswordInput = document.getElementById('confirmNewPassword');
    const passwordError = document.getElementById('passwordError');
    const cancelChangePassword = document.getElementById('cancelChangePassword');
    const saveNewPassword = document.getElementById('saveNewPassword');
    
    // Elementos de registro
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const loginContent = document.getElementById('loginContent');
    const registerContent = document.getElementById('registerContent');
    const registerButton = document.getElementById('registerButton');
    const registerEmail = document.getElementById('registerEmail');
    const registerUsername = document.getElementById('registerUsername');
    const registerPassword = document.getElementById('registerPassword');
    const confirmPassword = document.getElementById('confirmPassword');
    const registerError = document.getElementById('registerError');
    
    // Elementos de código de acesso
    const accessCode = document.getElementById('accessCode');
    const accessButton = document.getElementById('accessButton');
    const codeError = document.getElementById('codeError');
    const desktopOption = document.getElementById('desktopOption');
    const mobileOption = document.getElementById('mobileOption');
    
    // Elementos de alternância de visualização
    const viewToggle = document.getElementById('viewToggle');
    const desktopViewButton = document.getElementById('desktopViewButton');
    const mobileViewButton = document.getElementById('mobileViewButton');
    
    // Variáveis para controle de visualização
    let selectedViewMode = 'desktop'; // Padrão: desktop
    
    // URLs dos relatórios Power BI com códigos de acesso
    const reportCodes = {
        '2121': {
            name: 'Power bi Bendito',
            url: 'https://app.powerbi.com/view?r=eyJrIjoiOTU3NTc1YTUtMWJjMS00OTE1LWFjMGMtMzhkZjU4ODdhZWFhIiwidCI6Ijk2OWI5ZDQ2LTg3MWMtNDNlZS04MTJhLWVmY2FmMGYzMDFhZiJ9',
            type: 'desktop'
        },
        '2511': {
            name: 'Power bi Bendito - operacional',
            url: 'https://app.powerbi.com/view?r=eyJrIjoiNDUxZjg2ZDctMTk2YS00MDdhLTg3NTUtMmIzYTU2OTVlMTliIiwidCI6Ijk2OWI5ZDQ2LTg3MWMtNDNlZS04MTJhLWVmY2FmMGYzMDFhZiJ9',
            type: 'desktop'
        },
        '3636': {
            name: 'Power bi Bendito - versão celular',
            url: 'https://app.powerbi.com/view?r=eyJrIjoiYzA1MDI4ZDItNzMyYi00OTZkLWJkMzAtMzg1MDczZGFkNmEzIiwidCI6Ijk2OWI5ZDQ2LTg3MWMtNDNlZS04MTJhLWVmY2FmMGYzMDFhZiJ9',
            type: 'mobile'
        }
    };
    
    // Usuários (em um ambiente real, isso estaria em um banco de dados)
    // Aqui estamos simulando com localStorage para persistência
    if (!localStorage.getItem('users')) {
        // Definir os usuários padrão
        const defaultUsers = {
            'renan': {
                password: '1234',
                email: 'renan@exemplo.com'
            },
            'bruno': {
                password: '1234',
                email: 'bruno@exemplo.com'
            }
        };
        localStorage.setItem('users', JSON.stringify(defaultUsers));
    }
    
    // Para depuração - mostrar os usuários no console
    console.log('Usuários disponíveis:', JSON.parse(localStorage.getItem('users')));
    
    // Verificar se já está logado
    checkLoginStatus();
    
    // Detectar tipo de dispositivo e definir visualização padrão
    function detectDeviceType() {
        // Verificar se é um dispositivo móvel usando User Agent
        const mobileUserAgent = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Verificar se a tela é pequena (típico de dispositivos móveis)
        const smallScreen = window.innerWidth <= 768;
        
        // Verificar se tem recursos de toque (típico de dispositivos móveis)
        const touchEnabled = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // Combinar os fatores para uma detecção mais precisa
        const isMobile = mobileUserAgent || (smallScreen && touchEnabled);
        
        console.log('Detecção de dispositivo:', {
            mobileUserAgent,
            smallScreen,
            touchEnabled,
            resultado: isMobile ? 'mobile' : 'desktop'
        });
        
        return isMobile ? 'mobile' : 'desktop';
    }
    
    // Função para selecionar opção de visualização
    function selectViewOption(option) {
        // Remover seleção anterior
        desktopOption.classList.remove('selected');
        mobileOption.classList.remove('selected');
        
        // Adicionar seleção à opção escolhida
        if (option === 'desktop') {
            desktopOption.classList.add('selected');
            selectedViewMode = 'desktop';
        } else {
            mobileOption.classList.add('selected');
            selectedViewMode = 'mobile';
        }
    }
    
    // Função para verificar código de acesso
    function checkAccessCode() {
        const code = accessCode.value.trim();
        
        if (!code) {
            showCodeError('Por favor, digite o código de acesso.');
            return;
        }
        
        if (reportCodes[code]) {
            // Código válido
            const reportInfo = reportCodes[code];
            
            // Salvar o código para uso posterior
            localStorage.setItem('currentReportCode', code);
            
            // Verificar se o tipo de relatório corresponde à visualização selecionada
            if (reportInfo.type !== selectedViewMode) {
                // Ajustar a visualização para corresponder ao tipo de relatório
                selectedViewMode = reportInfo.type;
            }
            
            // Configurar a visualização
            if (selectedViewMode === 'mobile') {
                setMobileView();
            } else {
                setDesktopView();
            }
            
            // Carregar o relatório
            loadReport(reportInfo.url);
            
            // Esconder a tela de código
            codeContainer.classList.add('hidden');
        } else {
            // Código inválido
            showCodeError('Código de acesso inválido. Tente novamente.');
        }
    }
    
    // Função para mostrar erro de código
    function showCodeError(message) {
        codeError.textContent = message;
        codeError.classList.add('visible');
    }
    
    // Função para carregar relatório
    function loadReport(url) {
        // Mostrar o overlay de carregamento
        loadingOverlay.style.display = 'flex';
        
        // Configurar o iframe para ter fundo transparente
        reportFrame.style.backgroundColor = 'transparent';
        
        // Carregar o relatório
        reportFrame.src = url;
        
        // Adicionar um listener para quando o iframe terminar de carregar
        reportFrame.onload = function() {
            console.log('Relatório carregado com sucesso');
            
            // Esconder o overlay de carregamento após um pequeno atraso
            setTimeout(function() {
                loadingOverlay.style.display = 'none';
            }, 1000);
        };
    }
    
    // Definir visualização com base no tipo de dispositivo ou preferência salva
    function setInitialViewMode() {
        const savedViewMode = localStorage.getItem('viewMode');
        const deviceType = detectDeviceType();
        
        // Usar preferência salva ou detectar automaticamente
        const viewMode = savedViewMode || deviceType;
        
        console.log('Modo de visualização inicial:', viewMode, savedViewMode ? '(preferência salva)' : '(auto-detectado)');
        
        if (viewMode === 'mobile') {
            setMobileView(savedViewMode ? false : true);
        } else {
            setDesktopView(savedViewMode ? false : true);
        }
        
        // Mostrar indicador de auto-detecção se não houver preferência salva
        if (!savedViewMode) {
            viewToggle.classList.add('auto-detected');
            
            // Remover o indicador após 5 segundos
            setTimeout(() => {
                viewToggle.classList.remove('auto-detected');
            }, 5000);
        }
    }
    
    // Função para definir visualização desktop
    function setDesktopView(isAutoDetected = false) {
        reportContainer.classList.remove('mobile-view');
        desktopViewButton.classList.add('active');
        mobileViewButton.classList.remove('active');
        
        // Salvar preferência apenas se não for auto-detectado
        if (!isAutoDetected) {
            localStorage.setItem('viewMode', 'desktop');
            viewToggle.classList.remove('auto-detected');
        }
        
        // Verificar se há um código de relatório salvo
        const currentCode = localStorage.getItem('currentReportCode');
        if (currentCode && reportCodes[currentCode]) {
            // Se o relatório atual for do tipo mobile e estamos mudando para desktop
            if (reportCodes[currentCode].type === 'mobile') {
                // Procurar um relatório desktop para o mesmo usuário
                for (const code in reportCodes) {
                    if (reportCodes[code].type === 'desktop') {
                        localStorage.setItem('currentReportCode', code);
                        loadReport(reportCodes[code].url);
                        break;
                    }
                }
            } else {
                // Recarregar o relatório atual
                loadReport(reportCodes[currentCode].url);
            }
        }
    }
    
    // Função para definir visualização mobile
    function setMobileView(isAutoDetected = false) {
        reportContainer.classList.add('mobile-view');
        desktopViewButton.classList.remove('active');
        mobileViewButton.classList.add('active');
        
        // Salvar preferência apenas se não for auto-detectado
        if (!isAutoDetected) {
            localStorage.setItem('viewMode', 'mobile');
            viewToggle.classList.remove('auto-detected');
        }
        
        // Verificar se há um código de relatório salvo
        const currentCode = localStorage.getItem('currentReportCode');
        if (currentCode && reportCodes[currentCode]) {
            // Se o relatório atual for do tipo desktop e estamos mudando para mobile
            if (reportCodes[currentCode].type === 'desktop') {
                // Procurar o relatório mobile (código 3636)
                if (reportCodes['3636']) {
                    localStorage.setItem('currentReportCode', '3636');
                    loadReport(reportCodes['3636'].url);
                }
            } else {
                // Recarregar o relatório atual
                loadReport(reportCodes[currentCode].url);
            }
        }
    }
    
    // Função para verificar status de login
    function checkLoginStatus() {
        const currentUser = localStorage.getItem('currentUser');
        if (currentUser) {
            // Usuário está logado
            userName.textContent = currentUser;
            userInfo.classList.remove('hidden');
            loginContainer.classList.add('hidden');
            
            // Verificar se já tem um código de relatório salvo
            const currentCode = localStorage.getItem('currentReportCode');
            if (currentCode && reportCodes[currentCode]) {
                // Já tem um relatório selecionado, carregar diretamente
                if (reportCodes[currentCode].type === 'mobile') {
                    setMobileView();
                } else {
                    setDesktopView();
                }
                loadReport(reportCodes[currentCode].url);
                codeContainer.classList.add('hidden');
            } else {
                // Mostrar tela de seleção de código
                codeContainer.classList.remove('hidden');
                // Pré-selecionar a opção com base no dispositivo
                selectViewOption(detectDeviceType());
            }
        }
    }
    
    // Função para fazer login
    function login() {
        const username = usernameInput.value.trim().toLowerCase();
        const password = passwordInput.value;
        
        if (!username || !password) {
            showLoginError('Preencha todos os campos.');
            return;
        }
        
        // Para depuração - mostrar tentativa de login
        console.log('Tentativa de login:', username, password);
        
        const users = JSON.parse(localStorage.getItem('users'));
        console.log('Usuários disponíveis durante login:', users);
        
        if (users[username] && users[username].password === password) {
            // Login bem-sucedido
            console.log('Login bem-sucedido para:', username);
            localStorage.setItem('currentUser', username);
            
            // Mostrar nome do usuário
            userName.textContent = username;
            userInfo.classList.remove('hidden');
            loginContainer.classList.add('hidden');
            
            // Mostrar tela de código de acesso
            codeContainer.classList.remove('hidden');
            
            // Pré-selecionar a opção com base no dispositivo
            selectViewOption(detectDeviceType());
            
            clearLoginForm();
        } else {
            // Login falhou
            console.log('Login falhou para:', username);
            showLoginError('Usuário ou senha incorretos. Tente novamente.');
        }
    }
    
    // Função para registrar novo usuário
    function register() {
        const email = registerEmail.value.trim();
        const username = registerUsername.value.trim().toLowerCase();
        const password = registerPassword.value;
        const confirmPwd = confirmPassword.value;
        
        // Validações
        if (!email || !username || !password || !confirmPwd) {
            showRegisterError('Preencha todos os campos.');
            return;
        }
        
        if (!isValidEmail(email)) {
            showRegisterError('Email inválido.');
            return;
        }
        
        if (password !== confirmPwd) {
            showRegisterError('As senhas não coincidem.');
            return;
        }
        
        if (password.length < 4) {
            showRegisterError('A senha deve ter pelo menos 4 caracteres.');
            return;
        }
        
        // Verificar se o usuário já existe
        const users = JSON.parse(localStorage.getItem('users'));
        if (users[username]) {
            showRegisterError('Este nome de usuário já está em uso.');
            return;
        }
        
        // Adicionar novo usuário
        users[username] = {
            password: password,
            email: email
        };
        
        localStorage.setItem('users', JSON.stringify(users));
        console.log('Novo usuário registrado:', username);
        
        // Limpar formulário e mostrar mensagem de sucesso
        clearRegisterForm();
        alert('Cadastro realizado com sucesso! Faça login para continuar.');
        
        // Mudar para a aba de login
        switchTab('login');
    }
    
    // Função para validar email
    function isValidEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    // Função para mostrar erro de login
    function showLoginError(message) {
        loginError.textContent = message;
        loginError.classList.add('visible');
    }
    
    // Função para mostrar erro de registro
    function showRegisterError(message) {
        registerError.textContent = message;
        registerError.classList.add('visible');
    }
    
    // Função para limpar formulário de login
    function clearLoginForm() {
        usernameInput.value = '';
        passwordInput.value = '';
        loginError.classList.remove('visible');
    }
    
    // Função para limpar formulário de registro
    function clearRegisterForm() {
        registerEmail.value = '';
        registerUsername.value = '';
        registerPassword.value = '';
        confirmPassword.value = '';
        registerError.classList.remove('visible');
    }
    
    // Função para alternar entre abas
    function switchTab(tab) {
        if (tab === 'login') {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginContent.classList.add('active');
            registerContent.classList.remove('active');
        } else {
            loginTab.classList.remove('active');
            registerTab.classList.add('active');
            loginContent.classList.remove('active');
            registerContent.classList.add('active');
        }
    }
    
    // Função para fazer logout
    function logout() {
        localStorage.removeItem('currentUser');
        localStorage.removeItem('currentReportCode');
        userInfo.classList.add('hidden');
        loginContainer.classList.remove('hidden');
        codeContainer.classList.add('hidden');
        reportFrame.src = 'about:blank';
        loadingOverlay.style.display = 'none';
        clearLoginForm();
        clearRegisterForm();
        switchTab('login');
    }
    
    // Função para abrir modal de alteração de senha
    function openChangePasswordModal() {
        currentPasswordInput.value = '';
        newPasswordInput.value = '';
        confirmNewPasswordInput.value = '';
        passwordError.classList.remove('visible');
        passwordError.textContent = '';
        changePasswordModal.classList.add('visible');
    }
    
    // Função para fechar modal de alteração de senha
    function closeChangePasswordModal() {
        changePasswordModal.classList.remove('visible');
    }
    
    // Função para alterar senha
    function changePassword() {
        const currentUser = localStorage.getItem('currentUser');
        const users = JSON.parse(localStorage.getItem('users'));
        const currentPassword = currentPasswordInput.value;
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmNewPasswordInput.value;
        
        // Verificar senha atual
        if (users[currentUser].password !== currentPassword) {
            showPasswordError('Senha atual incorreta.');
            return;
        }
        
        // Verificar se as novas senhas coincidem
        if (newPassword !== confirmPassword) {
            showPasswordError('As senhas não coincidem.');
            return;
        }
        
        // Verificar se a nova senha tem pelo menos 4 caracteres
        if (newPassword.length < 4) {
            showPasswordError('A nova senha deve ter pelo menos 4 caracteres.');
            return;
        }
        
        // Atualizar senha
        users[currentUser].password = newPassword;
        localStorage.setItem('users', JSON.stringify(users));
        
        // Fechar modal
        closeChangePasswordModal();
        
        // Mostrar confirmação
        alert('Senha alterada com sucesso!');
    }
    
    // Função para mostrar erro de senha
    function showPasswordError(message) {
        passwordError.textContent = message;
        passwordError.classList.add('visible');
    }
    
    // Monitorar mudanças na orientação e tamanho da tela
    window.addEventListener('resize', function() {
        // Se não houver preferência salva, ajustar automaticamente
        if (!localStorage.getItem('viewMode')) {
            const deviceType = detectDeviceType();
            
            if (deviceType === 'mobile' && !reportContainer.classList.contains('mobile-view')) {
                setMobileView(true);
                viewToggle.classList.add('auto-detected');
                
                setTimeout(() => {
                    viewToggle.classList.remove('auto-detected');
                }, 3000);
            } else if (deviceType === 'desktop' && reportContainer.classList.contains('mobile-view')) {
                setDesktopView(true);
                viewToggle.classList.add('auto-detected');
                
                setTimeout(() => {
                    viewToggle.classList.remove('auto-detected');
                }, 3000);
            }
        }
    });
    
    // Event Listeners
    loginButton.addEventListener('click', login);
    registerButton.addEventListener('click', register);
    accessButton.addEventListener('click', checkAccessCode);
    
    // Opções de visualização
    desktopOption.addEventListener('click', function() {
        selectViewOption('desktop');
    });
    
    mobileOption.addEventListener('click', function() {
        selectViewOption('mobile');
    });
    
    // Permitir login com Enter
    passwordInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            login();
        }
    });
    
    // Permitir registro com Enter
    confirmPassword.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            register();
        }
    });
    
    // Permitir código com Enter
    accessCode.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            checkAccessCode();
        }
    });
    
    // Alternar entre abas
    loginTab.addEventListener('click', function() {
        switchTab('login');
    });
    
    registerTab.addEventListener('click', function() {
        switchTab('register');
    });
    
    // Alternar entre visualizações
    desktopViewButton.addEventListener('click', function() {
        setDesktopView();
    });
    
    mobileViewButton.addEventListener('click', function() {
        setMobileView();
    });
    
    logoutButton.addEventListener('click', logout);
    changePasswordButton.addEventListener('click', openChangePasswordModal);
    cancelChangePassword.addEventListener('click', closeChangePasswordModal);
    saveNewPassword.addEventListener('click', changePassword);
    
    // Fechar modal ao clicar fora dele
    changePasswordModal.addEventListener('click', function(e) {
        if (e.target === changePasswordModal) {
            closeChangePasswordModal();
        }
    });
    
    // Prevenir zoom em dispositivos móveis ao focar nos inputs
    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    });
});
</script>
</body>
</html>